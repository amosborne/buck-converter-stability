\documentclass{tufte-handout}

\usepackage{hyperref} % hyperlinks
	\hypersetup{colorlinks}
\usepackage{tikz}     % block diagrams
	\usetikzlibrary{matrix}
\usepackage{amsmath}  % extended mathematics

\title{Current-Mode Control Small-Signal Model\thanks{\href{https://ridleyengineering.com/images/current_mode_book/CurrentModeControl.pdf}{Original derivations by Dr. Raymond B. Ridley of Ridley Engineering.}}}

\author[Alexander Osborne]{Alexander Osborne}

\begin{document}

\maketitle

\begin{abstract}
\noindent
This document seeks to clarify the block diagrams and equations presented in Dr. Raymond B. Ridley's PhD dissertation, "A New Small-Signal Model for Current-Mode Control."
All equations presented herein are as applied to a buck converter with constant-frequency, trailing-edge peak current-mode control.
\end{abstract}

\section{Small-Signal Block Diagram}

\begin{fullwidth}
\begin{tikzpicture}[auto,
                    >=latex,
                    block/.style={draw, rectangle, align=center, minimum height=2.25em, minimum width=2.25em},
                    circ/.style={draw, circle, align=center, inner sep=0pt, minimum size=1em},
                    ra/.style={->, rounded corners=0.5em}]

\matrix[column sep=0.75cm, row sep=0.5cm]{

\node (vghat) {$\widehat{v}_g$}; \\

& \node [block] (kf) {$k_f$}; & & & & 
\node [block] (D) {$D$}; \\

\node (vchat) {$\widehat{v}_c$}; &
\node [circ] (c21) {$+$}; &
\node [circ] (c22) {$+$}; &
\node [block] (Fm) {$F_m$}; &
\node [block] (Vg) {$V_g$}; &
\node [circ] (c25) {$+$}; &
\node [block] (sL) {$\frac{1}{sL+Z_o(s)}$}; &
\node [block] (Zo) {$Z_o(s)$}; &
\node (vohat) {$\widehat{v}_o$}; \\

& & & & \node [block] (He) {$H_e(s)$}; &
\node [block] (Ri) {$R_i$}; \\

& & & & & \node [block] (kr) {$k_r$}; \\};

\draw [ra] (vghat) -| (D);
\draw [->] (vghat) -| (kf);
\draw [->] (kf) -- (c21);
\draw [->] (vchat) -- (c21);
\draw [->] (D) -- (c25);
\draw [->] (c21) -- (c22);
\draw [->] (c22) -- (Fm);
\draw [->] (Fm) -- node {$\widehat{d}$} (Vg);
\draw [->] (Vg) -- (c25);
\draw [->] (c25) -- (sL);
\draw [->] (sL) -- node[name=ic] {$\widehat{i}_c$} (Zo);
\draw [->] (Zo) -- node[name=vo] {} (vohat);
\draw [ra] (ic) |- (Ri);
\draw [->] (Ri) -- (He);
\draw [ra] (He) -| node[pos=0.9] {$-$} (c22);
\draw [ra] (kr) -| (c21);
\draw [ra] (vo) |- (kr);
\end{tikzpicture}
\end{fullwidth}

\marginnote[2em]{$V_g$ \ \ steady-state input voltage}
\marginnote{$V_o$ \ \ steady-state output voltage}
\marginnote{$D=V_o/V_g$ \ \ steady-state duty cycle}
\marginnote{$\widehat{v}_g$ \ \ small-signal input voltage}
\marginnote{$\widehat{v}_o$ \ \ small-signal output voltage}
\marginnote{$\widehat{d}$ \ \ small-signal duty cycle}
\marginnote{$\widehat{i}_c$ \ \ small-signal inductor current}
\marginnote{$\widehat{v}_c$ \ \ small-signal control voltage}
\marginnote{$sL$ \ \ inductor impedance}
\marginnote{$Z_o(s)$ \ \ output impedance}
\marginnote{$R_i$ \ \ sense resistor}
\marginnote{$H_e(s)$ \ \ sample-and-hold effect}
\marginnote{$F_m$ \ \ modulation gain}
\marginnote{$k_f$ \ \ input feed-forward gain}
\marginnote{$k_r$ \ \ output feed-forward gain}
\marginnote{$S_e$ \ \ slope compensation ramp}
\marginnote{$S_n=(V_g-V_o)R_i/L$ \ \ on-time ramp}
\marginnote{$S_f=V_oR_i/L$ \ \ off-time ramp}
\marginnote{$T_s$ \ \ switching period}

Dr. Ridley's diagrams generally mix transfer function blocks with circuit element symbols.
As an alternative, a complete transfer function block diagram is provided above.
Transfer function descriptions and key parameter definitions are in the margins.
\begin{align*}
F_m&=\frac{1}{(S_n+S_e)T_s}\\[0.75em]
H_e(s)&=1-s\frac{T_s}{2}+s^2\left(\frac{T_s}{\pi}\right)^2\\[0.75em]
k_f&=\frac{-DT_sR_i}{L}\left(1-\frac{D}{2}\right)\\[0.75em]
k_r&=\frac{T_sR_i}{2L}
\end{align*}

Multiple forms of the modulation gain $F_m$ can be found in literature; their differences stem from how the average inductor current is defined relative to the peak.
Dr. Ridley has experimentally verified the modulation gain used in this model is correct.

$H_e(s)$ is an approximation that is only valid up to one-half the switching frequency.
Such an approximation will suffice because a stable system must have a crossover frequency beneath the Nyquist frequency of the system.

In order to simplify the design of the outer voltage loop feedback compensation network, a transfer function from the duty cycle to inductor current $F_i$ can be defined that is independent of the output impedance $Z_o(s)$.
Such a transfer function will only be valid for frequencies where $Z_o(s) \ll sL$. Assuming the output impedance is predominantly capacitive, this transfer function would apply above the resonant frequency.
\begin{align*}
F_i&=\frac{\widehat{i}_c}{\widehat{d}}=\frac{V_g}{sL}=\frac{S_n+S_f}{sR_i}\\[0.75em]
\alpha&=\frac{S_f-S_e}{S_n+S_e}\\[0.75em]
F_mF_i&=\frac{1+\alpha}{sR_iT_s}
\end{align*}

The output voltage feed-forward gain $k_r$ can be ignored unless analyzing the low frequency gain of a converter operating near discontinuous conduction mode. The transfer function from the control voltage to inductor current $F(s)$ then becomes rather simple.

$$F(s)=\frac{\widehat{i}_c}{\widehat{v}_c}=\frac{F_mF_i}{1+F_mF_iR_iH_e(s)}$$

\end{document}